<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Switching Cognitive Test</title>
    <link rel="stylesheet" href="/css/task-switching.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Supabase JavaScript Library -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="app-logo">
                    <span class="material-icons">psychology</span>
                </div>
                <h1>Menopause Management Tool To Lean On</h1>
                <p class="auth-subtitle">Sign in to save your test results, get personalized predictions and recommendations</p>
            </div>

            <div class="auth-tabs">
                <button id="signInTab" class="tab-btn active">
                    <span class="material-icons">login</span>
                    Sign In
                </button>
                <button id="signUpTab" class="tab-btn">
                    <span class="material-icons">person_add</span>
                    Sign Up
                </button>
            </div>

            <div id="signInForm" class="auth-form-content">
                <div class="form-group">
                    <div class="input-container">
                        <span class="material-icons input-icon">email</span>
                        <input type="email" id="signInEmail" placeholder="Email address" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-container">
                        <span class="material-icons input-icon">lock</span>
                        <input type="password" id="signInPassword" placeholder="Password" required>
                    </div>
                </div>
                <button id="signInBtn" class="btn btn-primary">
                    <span class="btn-text">Sign In</span>
                    <span class="material-icons btn-icon">arrow_forward</span>
                </button>
                <div id="signInError" class="error-message"></div>
            </div>

            <div id="signUpForm" class="auth-form-content hidden">
                <div class="form-group">
                    <div class="input-container">
                        <span class="material-icons input-icon">email</span>
                        <input type="email" id="signUpEmail" placeholder="Email address" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-container">
                        <span class="material-icons input-icon">lock</span>
                        <input type="password" id="signUpPassword" placeholder="Password (min 6 characters)" required>
                    </div>
                </div>
                <button id="signUpBtn" class="btn btn-primary">
                    <span class="btn-text">Create Account</span>
                    <span class="material-icons btn-icon">arrow_forward</span>
                </button>
                <div id="signUpError" class="error-message"></div>
            </div>

            <div class="auth-footer">
                <p class="privacy-note">
                    <span class="material-icons">security</span>
                    Your data is protected and will only be used for research purposes if explicitly allowed
                </p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <header class="app-header">
            <div class="user-info">
                <span id="userEmail" class="user-email"></span>
                <button id="signOutBtn" class="btn btn-sm btn-secondary hidden">
                    <span class="material-icons">logout</span>
                    Sign Out
                </button>
            </div>
            <div class="app-title">
                <h1>Task Switching Cognitive Test</h1>
            </div>
        </header>

        <main class="app-main">
            <div id="testContainer">
                <div class="test-phase" id="instructionsPhase">
                    <h2>Instructions</h2>
                    <div class="instructions-content">
                        <p>This is a cognitive test that measures your ability to switch between different tasks.</p>
                        <p>You will see colored shapes and need to respond based on either the <strong>color</strong> or <strong>shape</strong> of the stimulus.</p>

                        <h3>Task Rules:</h3>
                        <ul>
                            <li><strong>Color Task:</strong> Press LEFT for yellow, RIGHT for blue</li>
                            <li><strong>Shape Task:</strong> Press LEFT for circle, RIGHT for rectangle</li>
                        </ul>

                        <p>A cue will appear before each stimulus to tell you which task to perform.</p>
                        <p>Please respond as quickly and accurately as possible.</p>

                        <h3>Controls:</h3>
                        <ul>
                            <li>Press <strong>B</strong> for LEFT responses</li>
                            <li>Press <strong>N</strong> for RIGHT responses</li>
                        </ul>
                    </div>
                    <button id="startBtn" class="btn btn-primary">Start Test</button>
                    <button id="viewHistoryBtn" class="btn btn-secondary hidden">View Previous Results</button>
                </div>

                <!-- Training Phase -->
                <div class="test-phase hidden" id="training">
                    <h2>Training Phase</h2>
                    <div class="progress">
                        <div class="progress-bar" id="trainingProgress">
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                    <div id="trainingTrial" class="trial-container">
                        <div class="fixation-point">+</div>
                    </div>
                </div>

                <!-- Test Phase -->
                <div class="test-phase hidden" id="test">
                    <h2>Test Phase</h2>
                    <div class="progress">
                        <div class="progress-bar" id="testProgress">
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                    <div id="testTrial" class="trial-container">
                        <div class="fixation-point">+</div>
                    </div>
                </div>

                <!-- Previous Results Section -->
                <div class="test-phase hidden" id="historyPhase">
                    <h2>Your Previous Results</h2>
                    <div id="historyContent">
                        <div class="loading">Loading your test history...</div>
                    </div>
                    <button id="backToInstructionsBtn" class="btn btn-secondary">Back to Instructions</button>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/task-switching.js"></script>
</body>
</html>